<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live IPTV Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4898030606400937"
     crossorigin="anonymous"></script>

<!-- hls.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #fff;
}

header {
  background: #020617;
  padding: 14px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}

.container {
  display: flex;
  height: calc(100vh - 60px);
}

.sidebar {
  width: 300px;
  background: #020617;
  overflow-y: auto;
  border-right: 1px solid #1e293b;
}

.sidebar input {
  width: 90%;
  margin: 10px;
  padding: 8px;
  border-radius: 6px;
  border: none;
}

.channel {
  padding: 10px;
  border-bottom: 1px solid #1e293b;
  cursor: pointer;
}

.channel:hover {
  background: #1e293b;
}

.player {
  flex: 1;
  padding: 10px;
}

video {
  width: 100%;
  height: 60vh;
  background: black;
}

.ads {
  margin-top: 10px;
  text-align: center;
}

@media (max-width: 768px) {
  .container {
    flex-direction: column;
  }
  .sidebar {
    width: 100%;
    height: 250px;
  }
}
</style>
</head>

<body>

<header>ðŸ“º Free Live IPTV Channels</header>

<div class="container">
  <div class="sidebar">
    <input type="text" id="search" placeholder="Search channel...">
    <div id="channels"></div>
  </div>

  <div class="player">
    <video id="video" controls autoplay></video>

    <!-- Ad -->
    <div class="ads">
      <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-4898030606400937"
        data-ad-slot="1234567890"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>

<script>
const M3U_URL = "https://iptv-org.github.io/iptv/index.m3u";
const channelsDiv = document.getElementById("channels");
const searchInput = document.getElementById("search");
const video = document.getElementById("video");
let hls;
let channels = [];

fetch(M3U_URL)
  .then(res => res.text())
  .then(text => parseM3U(text))
  .catch(() => alert("Failed to load channel list"));

function parseM3U(data) {
  const lines = data.split("\n");
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].startsWith("#EXTINF")) {
      const name = lines[i].split(",")[1] || "Unknown Channel";
      const url = lines[i + 1];
      if (url && url.startsWith("http")) {
        channels.push({ name, url });
      }
    }
  }
  renderChannels(channels);
}

function renderChannels(list) {
  channelsDiv.innerHTML = "";
  list.forEach(ch => {
    const div = document.createElement("div");
    div.className = "channel";
    div.textContent = ch.name;
    div.onclick = () => playChannel(ch.url);
    channelsDiv.appendChild(div);
  });
}

function playChannel(url) {
  if (hls) {
    hls.destroy();
  }

  if (Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.play();
    });
  } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
    video.src = url;
    video.play();
  } else {
    alert("This stream is not supported in your browser");
  }
}

searchInput.addEventListener("input", () => {
  const q = searchInput.value.toLowerCase();
  const filtered = channels.filter(c =>
    c.name.toLowerCase().includes(q)
  );
  renderChannels(filtered);
});
</script>

</body>
</html>
